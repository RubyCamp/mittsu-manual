<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<title>ライト - Ruby合宿2022春・Mittsuライブラリマニュアル</title>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=icon href=https://rubycamp.github.io/mittsu-manual/favicon.png>
<link rel=stylesheet href=https://rubycamp.github.io/mittsu-manual/css/style.min.6719d72e323121369d5caeb4264b95d8a63cf1deaab029da67602fe5a046e0a4.css>
</head>
<body class="page page-default-single">
<div id=main-menu-mobile class=main-menu-mobile>
<ul>
<li class=menu-item-home>
<a href=https://rubycamp.github.io/mittsu-manual/>
<span>Home</span>
</a>
</li>
<li class=menu-item-リファレンスガイド>
<a href=https://rubycamp.github.io/mittsu-manual/docs/>
<span>リファレンスガイド</span>
</a>
</li>
</ul>
</div>
<div class=wrapper>
<div class=header>
<div class=container>
<div class=logo>
<a href=https://rubycamp.github.io/mittsu-manual><img alt=Logo src=https://rubycamp.github.io/mittsu-manual/images/logo.svg></a>
</div>
<div class=logo-mobile>
<a href=https://rubycamp.github.io/mittsu-manual><img alt=Logo src=https://rubycamp.github.io/mittsu-manual/images/logo-mobile.svg></a>
</div>
<div id=main-menu class=main-menu>
<ul>
<li class=menu-item-home>
<a href=https://rubycamp.github.io/mittsu-manual/>
<span>Home</span>
</a>
</li>
<li class=menu-item-リファレンスガイド>
<a href=https://rubycamp.github.io/mittsu-manual/docs/>
<span>リファレンスガイド</span>
</a>
</li>
</ul>
</div>
<button id=toggle-main-menu-mobile class="hamburger hamburger--slider" type=button>
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
</div>
</div>
<div class="container pt-2 pt-md-6 pb-3 pb-md-6">
<div class=row>
<div class="col-12 col-md-3 mb-3">
<div class=sidebar>
<div class=docs-menu>
<h4>Docs</h4>
<ul>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/1000_install/>インストール</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/1100_quick_start/>クイックスタートガイド</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/1150_scene/>Sceneクラス</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/1200_object_3d/>Object3Dクラス</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/3000_renderer/>Rendererクラス</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/4000_geometry/>ジオメトリ（形状）</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/5000_material/>マテリアル（質感）</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/6000_mesh/>メッシュ（物体）</a>
</li>
<li class=active>
<a href=https://rubycamp.github.io/mittsu-manual/docs/6500_light/>ライト</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/7000_camera/>カメラ</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/8000_events/>イベント</a>
</li>
<li>
<a href=https://rubycamp.github.io/mittsu-manual/docs/10000_collision/>当たり判定について</a>
</li>
</ul>
</div>
</div>
</div>
<div class="col-12 col-md-9">
<h1 class=title>ライト</h1>
<div class=content>
<h2 id=3d空間と光源ライト>3D空間と光源（ライト）</h2>
<p>何も追加しなければ、3D空間（シーン）は実は真っ暗闇です。</p>
<p>物体を追加しても、光源（ライト）が無ければレンダリング結果は真っ暗になります。</p>
<p>一部、Mittsu::MeshBasicMaterialのように、光源の影響を受けないため光源無しでも見えるマテリアルもありますが、
基本的には物体は光源無しにはレンダリングされません。</p>
<p>陰影の付いた3D画像は、物体と光源が合わさることで初めてレンダリングされるのです。</p>
<h2 id=ライトの種類>ライトの種類</h2>
<p>Mittsuでは、3D空間を照らす光源として、6種類のライトが用意されています。</p>
<p>本節では、その内Ruby合宿2022で使用する主な4種類について説明します。</p>
<p>代表的なライトであるMittsu::DirectionalLightを用いて、平面と立方体を組み合わせた構成で光源の
見え方を確認するプログラムを以下のように作成します。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=nb>require</span> <span class=s1>&#39;mittsu&#39;</span>

<span class=n>scene</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Scene</span><span class=o>.</span><span class=n>new</span>
<span class=n>scene</span><span class=o>.</span><span class=n>fog</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Uniform</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>:float</span><span class=p>,</span> <span class=mi>2000</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span>
<span class=n>camera</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>PerspectiveCamera</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mi>75</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=o>.</span><span class=mi>333</span><span class=p>,</span> <span class=mi>0</span><span class=o>.</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span>
<span class=n>renderer</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>OpenGLRenderer</span><span class=o>.</span><span class=n>new</span> <span class=ss>width</span><span class=p>:</span> <span class=mi>800</span><span class=p>,</span> <span class=ss>height</span><span class=p>:</span> <span class=mi>600</span><span class=p>,</span> <span class=ss>title</span><span class=p>:</span> <span class=s1>&#39;RubyCamp 2022&#39;</span>

<span class=n>light</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>DirectionalLight</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mh>0xffffff</span><span class=p>)</span>
<span class=n>light</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=n>scene</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>light</span><span class=p>)</span>

<span class=n>geom_box</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>BoxGeometry</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
<span class=n>mat_box</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>MeshPhongMaterial</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>color</span><span class=p>:</span> <span class=mh>0x00ff00</span><span class=p>)</span>
<span class=n>mesh_box</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Mesh</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>geom_box</span><span class=p>,</span> <span class=n>mat_box</span><span class=p>)</span>
<span class=n>mesh_box</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>z</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=o>.</span><span class=mi>5</span>
<span class=n>scene</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>mesh_box</span><span class=p>)</span>

<span class=n>geom_plane</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>PlaneGeometry</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<span class=n>mat_plane</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>MeshPhongMaterial</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>color</span><span class=p>:</span> <span class=mh>0x00ff00</span><span class=p>)</span>
<span class=n>mesh_plane</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Mesh</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>geom_plane</span><span class=p>,</span> <span class=n>mat_plane</span><span class=p>)</span>
<span class=n>mesh_plane</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>z</span> <span class=o>=</span> <span class=o>-</span><span class=mi>3</span>
<span class=n>mesh_plane</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
<span class=n>mesh_plane</span><span class=o>.</span><span class=n>rotation</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=o>-</span><span class=no>Math</span><span class=o>::</span><span class=no>PI</span> <span class=o>/</span> <span class=mi>2</span>
<span class=n>scene</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>mesh_plane</span><span class=p>)</span>


<span class=n>renderer</span><span class=o>.</span><span class=n>window</span><span class=o>.</span><span class=n>run</span> <span class=k>do</span>
	<span class=n>mesh_box</span><span class=o>.</span><span class=n>rotation</span><span class=o>.</span><span class=n>x</span> <span class=o>+=</span> <span class=mi>0</span><span class=o>.</span><span class=mo>05</span>
	<span class=n>mesh_box</span><span class=o>.</span><span class=n>rotation</span><span class=o>.</span><span class=n>y</span> <span class=o>+=</span> <span class=mi>0</span><span class=o>.</span><span class=mo>05</span>
	<span class=n>renderer</span><span class=o>.</span><span class=n>render</span><span class=p>(</span><span class=n>scene</span><span class=p>,</span> <span class=n>camera</span><span class=p>)</span>
<span class=k>end</span>
</code></pre></div><p>これを実行すると、以下のようになります。</p>
<figure class=center><img src=https://rubycamp.github.io/mittsu-manual/images/6500_light/fig_1.gif width=640 height=480>
</figure>
<p>以下、それぞれのライトについて使い方を見ていきましょう。</p>
<h5 id=directionallight>DirectionalLight</h5>
<p>特定の方向からシーンを照らす平行光源です。</p>
<p>無限遠から照らしているものと扱われるため、物体に当たる光線は平行に当たります。</p>
<p>initializeメソッドは以下のようになります。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=no>Mittsu</span><span class=o>::</span><span class=no>DirectionalLight</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>color</span> <span class=o>=</span> <span class=kp>nil</span><span class=p>,</span> <span class=n>intensity</span> <span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span> <span class=c1>#-&gt; DirectionalLight</span>
</code></pre></div><table>
<thead>
<tr>
<th>引数</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>color</td>
<td>光源の色（光の色）</td>
</tr>
<tr>
<td>intensity</td>
<td>光源の強さ</td>
</tr>
</tbody>
</table>
<p>前掲のサンプルのような見え方をします。</p>
<p>無限遠からの平行光源ですので、陰影を伴ってシーン全体を照らしたりする用途に向いていると思います。</p>
<h5 id=ambientlight>AmbientLight</h5>
<p>環境光（拡散環境光）を発する光源です。</p>
<p>シーン全体を均等に照らすような用途に用いると良いでしょう。</p>
<p>ただし、陰影を付けたりする用途にはあまり向かないかもしれません。</p>
<p>initializeメソッドは以下のようになります。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=no>Mittsu</span><span class=o>::</span><span class=no>AmbientLight</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>color</span><span class=p>)</span> <span class=c1>#-&gt; AmbientLight</span>
</code></pre></div><table>
<thead>
<tr>
<th>引数</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>color</td>
<td>光源の色（光の色）</td>
</tr>
</tbody>
</table>
<p>サンプルのライトをAmbientLightに変更すると、以下のように見えます。</p>
<figure class=center><img src=https://rubycamp.github.io/mittsu-manual/images/6500_light/fig_2.gif width=640 height=480>
</figure>
<h5 id=spotlight>SpotLight</h5>
<p>その名の通り「スポットライト」として用いる光源です。</p>
<p>スポットライトは、ある一定方向にしか光を発しませんので、向きや照らす距離、
ボカシや減衰率など細かなパラメータ調整ができる半面、思った通りの場所を照らすのに
多少慣れが必要なライトですが、その分リアルな陰影を表現しやすいライトでもあります。</p>
<p>initializeメソッドは以下のようになります。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=no>Mittsu</span><span class=o>::</span><span class=no>SpotLight</span><span class=o>.</span><span class=n>new</span><span class=p>(</span>
  <span class=n>color</span> <span class=o>=</span> <span class=kp>nil</span><span class=p>,</span> <span class=n>intensity</span> <span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span> <span class=n>distance</span> <span class=o>=</span> <span class=mi>0</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span>
  <span class=n>angle</span> <span class=o>=</span> <span class=p>(</span><span class=o>::</span><span class=no>Math</span><span class=o>::</span><span class=no>PI</span> <span class=o>/</span> <span class=mi>3</span><span class=o>.</span><span class=mi>0</span><span class=p>),</span> <span class=n>exponent</span> <span class=o>=</span> <span class=mi>10</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span> <span class=n>decay</span> <span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span> <span class=c1>#-&gt; SpotLight</span>
</code></pre></div><table>
<thead>
<tr>
<th>引数</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>color</td>
<td>光源の色（光の色）</td>
</tr>
<tr>
<td>intensity</td>
<td>光源の強さ</td>
</tr>
<tr>
<td>distance</td>
<td>ライトが照らす距離</td>
</tr>
<tr>
<td>angle</td>
<td>光源の角度</td>
</tr>
<tr>
<td>exponent</td>
<td>ボカシ具合</td>
</tr>
<tr>
<td>decay</td>
<td>減衰率</td>
</tr>
</tbody>
</table>
<p>サンプルのライトをSpotLightに変更すると、以下のように見えます。</p>
<figure class=center><img src=https://rubycamp.github.io/mittsu-manual/images/6500_light/fig_3.gif width=640 height=480>
</figure>
<h5 id=pointlight>PointLight</h5>
<p>ポイントライトは、スポットライトと似ていますが、設置した位置から全方位に対して
光を発する点がスポットライトと異なります。</p>
<p>全ての方位に光を放ってくれるので、扱いやすい反面絵としてはのっぺりとした印象に
なりやすい特徴があります。</p>
<p>initializeメソッドは以下のようになります。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=no>Mittsu</span><span class=o>::</span><span class=no>PointLight</span><span class=o>.</span><span class=n>new</span><span class=p>(</span>
	<span class=n>color</span> <span class=o>=</span> <span class=kp>nil</span><span class=p>,</span> <span class=n>intensity</span> <span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span>
	<span class=n>distance</span> <span class=o>=</span> <span class=mi>0</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span> <span class=n>decay</span> <span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span> <span class=c1>#-&gt; PointLight</span>
</code></pre></div><table>
<thead>
<tr>
<th>引数</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>color</td>
<td>光源の色（光の色）</td>
</tr>
<tr>
<td>intensity</td>
<td>光源の強さ</td>
</tr>
<tr>
<td>distance</td>
<td>ライトが照らす距離</td>
</tr>
<tr>
<td>decay</td>
<td>減衰率</td>
</tr>
</tbody>
</table>
<p>サンプルのライトをPointLightに変更すると、以下のように見えます。</p>
<figure class=center><img src=https://rubycamp.github.io/mittsu-manual/images/6500_light/fig_4.gif width=640 height=480>
</figure>
<h5 id=arealight>AreaLight</h5>
<p>エリアライトは、</p>
<p>initializeメソッドは以下のようになります。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=no>Mittsu</span><span class=o>::</span><span class=no>AreaLight</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>color</span> <span class=o>=</span> <span class=kp>nil</span><span class=p>,</span> <span class=n>intensity</span> <span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span> <span class=c1>#-&gt; AreaLight</span>
</code></pre></div><table>
<thead>
<tr>
<th>引数</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>color</td>
<td>光源の色（光の色）</td>
</tr>
<tr>
<td>intensity</td>
<td>光源の強さ</td>
</tr>
</tbody>
</table>
<p>サンプルのライトをAreaLightに変更すると、以下のように見えます。</p>
<figure class=center><img src=https://rubycamp.github.io/mittsu-manual/images/6500_light/fig_4.gif width=640 height=480>
</figure>
<h5 id=pointlight-1>PointLight</h5>
<p>ポイントライトは、スポットライトと似ていますが、設置した位置から全方位に対して
光を発する点がスポットライトと異なります。</p>
<p>全ての方位に光を放ってくれるので、扱いやすい反面絵としてはのっぺりとした印象に
なりやすい特徴があります。</p>
<p>initializeメソッドは以下のようになります。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=no>Mittsu</span><span class=o>::</span><span class=no>PointLight</span><span class=o>.</span><span class=n>new</span><span class=p>(</span>
	<span class=n>color</span> <span class=o>=</span> <span class=kp>nil</span><span class=p>,</span> <span class=n>intensity</span> <span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span>
    <span class=n>distance</span> <span class=o>=</span> <span class=mi>0</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span> <span class=n>decay</span> <span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span> <span class=c1>#-&gt; PointLight</span>
</code></pre></div><table>
<thead>
<tr>
<th>引数</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>color</td>
<td>光源の色（光の色）</td>
</tr>
<tr>
<td>intensity</td>
<td>光源の強さ</td>
</tr>
<tr>
<td>distance</td>
<td>ライトが照らす距離</td>
</tr>
<tr>
<td>decay</td>
<td>減衰率</td>
</tr>
</tbody>
</table>
<p>サンプルのライトをPointLightに変更すると、以下のように見えます。</p>
<figure class=center><img src=https://rubycamp.github.io/mittsu-manual/images/6500_light/fig_4.gif width=640 height=480>
</figure>
<h2 id=ライトの操作>ライトの操作</h2>
<p>ライトもまたメッシュやカメラと同じくObject3Dクラスを継承しています。</p>
<p>従って、メッシュなどと同様の手順で任意の位置に移動させたり回転させたりすることが可能です。</p>
<p>例えば、以下のようなプログラムを例にとってみましょう。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=nb>require</span> <span class=s1>&#39;mittsu&#39;</span>

<span class=n>scene</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Scene</span><span class=o>.</span><span class=n>new</span>
<span class=n>scene</span><span class=o>.</span><span class=n>fog</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Uniform</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>:float</span><span class=p>,</span> <span class=mi>2000</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span>
<span class=n>camera</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>PerspectiveCamera</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mi>75</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=o>.</span><span class=mi>333</span><span class=p>,</span> <span class=mi>0</span><span class=o>.</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span>
<span class=n>renderer</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>OpenGLRenderer</span><span class=o>.</span><span class=n>new</span> <span class=ss>width</span><span class=p>:</span> <span class=mi>800</span><span class=p>,</span> <span class=ss>height</span><span class=p>:</span> <span class=mi>600</span><span class=p>,</span> <span class=ss>title</span><span class=p>:</span> <span class=s1>&#39;RubyCamp 2022&#39;</span>

<span class=n>light</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>PointLight</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mh>0xffffff</span><span class=p>)</span>
<span class=n>scene</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>light</span><span class=p>)</span>

<span class=n>geom_box</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>BoxGeometry</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
<span class=n>mat_box</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>MeshPhongMaterial</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>color</span><span class=p>:</span> <span class=mh>0x00ff00</span><span class=p>)</span>
<span class=n>mesh_box</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Mesh</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>geom_box</span><span class=p>,</span> <span class=n>mat_box</span><span class=p>)</span>
<span class=n>mesh_box</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>z</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=o>.</span><span class=mi>5</span>
<span class=n>scene</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>mesh_box</span><span class=p>)</span>

<span class=n>r</span> <span class=o>=</span> <span class=mi>1</span>
<span class=n>theta</span> <span class=o>=</span> <span class=mi>0</span>
<span class=n>renderer</span><span class=o>.</span><span class=n>window</span><span class=o>.</span><span class=n>run</span> <span class=k>do</span>
  <span class=n>light</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>r</span> <span class=o>*</span> <span class=no>Math</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>theta</span><span class=p>)</span>
  <span class=n>light</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>z</span> <span class=o>=</span> <span class=n>r</span> <span class=o>*</span> <span class=no>Math</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>theta</span><span class=p>)</span>
  <span class=n>renderer</span><span class=o>.</span><span class=n>render</span><span class=p>(</span><span class=n>scene</span><span class=p>,</span> <span class=n>camera</span><span class=p>)</span>
  <span class=n>theta</span> <span class=o>+=</span> <span class=mi>0</span><span class=o>.</span><span class=mo>05</span>
<span class=k>end</span>
</code></pre></div><p>これを実行すると、</p>
<figure class=center><img src=https://rubycamp.github.io/mittsu-manual/images/6500_light/fig_5.gif width=640 height=480>
</figure>
<p>このように、ポイントライトがX-Z平面上を半径1単位で周回する様子が見て取れます。</p>
<h2 id=物体の影>物体の影</h2>
<p>現実の物体は、光を受けると影ができます。</p>
<p>しかし、これまで見てきたサンプルでは、</p>
<figure class=center><img src=https://rubycamp.github.io/mittsu-manual/images/6500_light/fig_3.gif width=640 height=480>
</figure>
<p>のように、陰影を付けることはできても、立方体の影が平面上に落ちることはありませんでした。</p>
<p>Mittsuでは、物体の影を別の物体に落とすためには、光源と物体、そしてレンダラーそのものに対して、
それぞれ影を生成するための設定をしてやらないと、影を作ることができません。</p>
<p>Ruby合宿2022では、影の生成までは範囲外としていますが、一例として以下に立方体の影を
平面に落とすためのサンプルを掲載しておきます。</p>
<p>興味があれば、サンプルのコメントなどを参考に自分でもやってみてください。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=nb>require</span> <span class=s1>&#39;mittsu&#39;</span>

<span class=n>scene</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Scene</span><span class=o>.</span><span class=n>new</span>
<span class=n>scene</span><span class=o>.</span><span class=n>fog</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Uniform</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>:float</span><span class=p>,</span> <span class=mi>2000</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span>
<span class=n>camera</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>PerspectiveCamera</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mi>75</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=o>.</span><span class=mi>333</span><span class=p>,</span> <span class=mi>0</span><span class=o>.</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span>
<span class=n>renderer</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>OpenGLRenderer</span><span class=o>.</span><span class=n>new</span> <span class=ss>width</span><span class=p>:</span> <span class=mi>800</span><span class=p>,</span> <span class=ss>height</span><span class=p>:</span> <span class=mi>600</span><span class=p>,</span> <span class=ss>title</span><span class=p>:</span> <span class=s1>&#39;RubyCamp 2022&#39;</span>

<span class=c1># レンダラーのシャドウマップを有効にし、ソフトシャドウに設定しておく</span>
<span class=n>renderer</span><span class=o>.</span><span class=n>shadow_map_enabled</span> <span class=o>=</span> <span class=kp>true</span>
<span class=n>renderer</span><span class=o>.</span><span class=n>shadow_map_type</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>PCFSoftShadowMap</span>

<span class=n>light</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>SpotLight</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mh>0xffffff</span><span class=p>,</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span>
<span class=n>light</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

<span class=c1># ライトが影を生成するようにする</span>
<span class=n>light</span><span class=o>.</span><span class=n>cast_shadow</span> <span class=o>=</span> <span class=kp>true</span>

<span class=c1># ライトが生成する影のパラメータを設定する</span>
<span class=n>light</span><span class=o>.</span><span class=n>shadow_darkness</span> <span class=o>=</span> <span class=mi>0</span><span class=o>.</span><span class=mi>5</span>     <span class=c1># 影の暗さを設定（あまり暗すぎても不自然なので半分程度に）</span>
<span class=n>light</span><span class=o>.</span><span class=n>shadow_map_width</span> <span class=o>=</span> <span class=mi>1024</span>   <span class=c1># シャドウマップのサイズ（横幅）を定義</span>
<span class=n>light</span><span class=o>.</span><span class=n>shadow_map_height</span> <span class=o>=</span> <span class=mi>1024</span>  <span class=c1># シャドウマップのサイズ（縦幅）を定義</span>
<span class=n>light</span><span class=o>.</span><span class=n>shadow_camera_near</span> <span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span>  <span class=c1># 影とカメラのクリッピング距離（近端）を設定</span>
<span class=n>light</span><span class=o>.</span><span class=n>shadow_camera_far</span> <span class=o>=</span> <span class=mi>100</span><span class=o>.</span><span class=mi>0</span> <span class=c1># 影とカメラのクリッピング距離（遠端）を設定</span>
<span class=n>light</span><span class=o>.</span><span class=n>shadow_camera_fov</span> <span class=o>=</span> <span class=mi>75</span><span class=o>.</span><span class=mi>0</span>  <span class=c1># 影の撮影画角を設定（基本的にはカメラのFOVに合わせておくのが吉）</span>
<span class=n>scene</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>light</span><span class=p>)</span>

<span class=n>geom_box</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>BoxGeometry</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
<span class=n>mat_box</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>MeshPhongMaterial</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>color</span><span class=p>:</span> <span class=mh>0x00ff00</span><span class=p>)</span>
<span class=n>mesh_box</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Mesh</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>geom_box</span><span class=p>,</span> <span class=n>mat_box</span><span class=p>)</span>
<span class=n>mesh_box</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>z</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=o>.</span><span class=mi>5</span>

<span class=c1># ライトからの光を受けた立方体メッシュが影を生成するように設定</span>
<span class=n>mesh_box</span><span class=o>.</span><span class=n>cast_shadow</span> <span class=o>=</span> <span class=kp>true</span>

<span class=n>scene</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>mesh_box</span><span class=p>)</span>

<span class=n>geom_plane</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>PlaneGeometry</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<span class=n>mat_plane</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>MeshPhongMaterial</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>color</span><span class=p>:</span> <span class=mh>0x00ff00</span><span class=p>)</span>
<span class=n>mesh_plane</span> <span class=o>=</span> <span class=no>Mittsu</span><span class=o>::</span><span class=no>Mesh</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>geom_plane</span><span class=p>,</span> <span class=n>mat_plane</span><span class=p>)</span>
<span class=n>mesh_plane</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>z</span> <span class=o>=</span> <span class=o>-</span><span class=mi>3</span>
<span class=n>mesh_plane</span><span class=o>.</span><span class=n>position</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
<span class=n>mesh_plane</span><span class=o>.</span><span class=n>rotation</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=o>-</span><span class=no>Math</span><span class=o>::</span><span class=no>PI</span> <span class=o>/</span> <span class=mi>2</span>

<span class=c1># 平面メッシュが影を受け取るように設定</span>
<span class=n>mesh_plane</span><span class=o>.</span><span class=n>receive_shadow</span> <span class=o>=</span> <span class=kp>true</span>

<span class=n>scene</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>mesh_plane</span><span class=p>)</span>


<span class=n>renderer</span><span class=o>.</span><span class=n>window</span><span class=o>.</span><span class=n>run</span> <span class=k>do</span>
  <span class=n>mesh_box</span><span class=o>.</span><span class=n>rotation</span><span class=o>.</span><span class=n>x</span> <span class=o>+=</span> <span class=mi>0</span><span class=o>.</span><span class=mo>05</span>
  <span class=n>mesh_box</span><span class=o>.</span><span class=n>rotation</span><span class=o>.</span><span class=n>y</span> <span class=o>+=</span> <span class=mi>0</span><span class=o>.</span><span class=mo>05</span>
  <span class=n>renderer</span><span class=o>.</span><span class=n>render</span><span class=p>(</span><span class=n>scene</span><span class=p>,</span> <span class=n>camera</span><span class=p>)</span>
<span class=k>end</span>
</code></pre></div><p>結構色々設定が必要ですね。</p>
<p>このサンプルを実行すると、以下のようになります。</p>
<figure class=center><img src=https://rubycamp.github.io/mittsu-manual/images/6500_light/fig_6.gif width=640 height=480>
</figure>
<p>このように、影については関連する光源と「影を作る物体」「影を受ける物体」を設定してやる
必要があります。</p>
<p>なんでデフォルトで全ての物体が影を作ったり受けたりできるようになっていないのかと言えば、
一般的に3Dグラフィクスのレンダリングにおいて、影の生成というのは比較的コストの高い処理
であるため、という理由が大きいでしょう。</p>
<p>今回くらいのサンプル程度であれば大したコストではありませんが、3D空間に登場する物体が
増えれば増えるほど、影を生成するコストは無視できないものになっていきます。</p>
<p>なので、デフォルトでは影は落とさないようにしておいて、影が必要な物体だけに設定する方が
コストが抑えやすいということは言えるでしょう。</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class=sub-footer>
<div class=container>
<div class=row>
<div class=col-12>
<div class=sub-footer-inner>
<ul>
<li class=zerostatic><a href=https://www.zerostatic.io>www.zerostatic.io</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<script type=text/javascript src=https://rubycamp.github.io/mittsu-manual/js/scripts.min.eaf147370baecdd07c022597db631f99cab1c9cd6479de586f30327a568d6a0f.js></script>
</body>
</html>